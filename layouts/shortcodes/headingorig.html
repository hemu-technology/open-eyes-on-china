{{/* headingorig shortcode
Params:
  title   : The heading text (required)
  level   : Heading level 1-6 (default 3)
  show    : Closed state label (default "Show Chinese")
  hide    : Open state label (default "Hide Chinese")
  lang    : Language code for original block (default "zh")
  id      : Optional id for the heading; auto-generated if omitted
Usage:
  {{< headingorig title="Content" level="3" >}}
  原文内容...
  {{< /headingorig >}}

Replaces pattern: A separate markdown heading + collapse block. Puts toggle button on the same line as the heading.
*/}}
{{ $title := .Get "title" | default "Section" }}
{{ $level := .Get "level" | default "3" }}
{{ if not (in (slice "1" "2" "3" "4" "5" "6") $level) }}{{ $level = "3" }}{{ end }}
{{ $show := .Get "show" | default "Show Chinese" }}
{{ $hide := .Get "hide" | default "Hide Chinese" }}
{{ $lang := .Get "lang" | default "zh" }}
{{ $id := .Get "id" | default (printf "h-orig-%d" (now.UnixNano)) }}
{{ $uid := printf "%s-%d" $id (now.UnixNano) }}
{{ $inner := .Inner }}
{{/* Render original content as markdown later */}}
{{ $tagOpen := printf "<h%s" $level }}
{{ $tagClose := printf "</h%s>" $level }}
{{ $heading := printf "%s class=\"oe-heading-orig\" id=\"%s\">" $tagOpen $id }}
{{ $headingEnd := $tagClose }}
{{/* Output structure */}}
<div class="oe-heading-orig-wrap" data-orig-wrap>
  {{ $heading | safeHTML }}
    <span class="oe-heading-orig__title">{{ $title }}</span>
    <button type="button" class="oe-heading-orig__btn" aria-expanded="false" aria-controls="{{ $uid }}-orig" data-label-show="{{ $show }}" data-label-hide="{{ $hide }}" aria-label="Toggle original: {{ $show }}">
      <span class="oe-heading-orig__icon" aria-hidden="true">
        <svg viewBox="0 0 16 16" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 6.5 8 10 12 6.5" /></svg>
      </span>
      <span class="oe-heading-orig__text">{{ $show }}</span>
    </button>
  {{ $headingEnd | safeHTML }}
  <div id="{{ $uid }}-orig" class="oe-heading-orig__content" hidden lang="{{ $lang }}">
    <div class="oe-heading-orig__inner">{{ $inner | markdownify }}</div>
  </div>
</div>
<script>(function(){const wrap=document.currentScript&&document.currentScript.previousElementSibling; if(!wrap) return; const btn=wrap.querySelector('.oe-heading-orig__btn'); if(!btn||btn.dataset.init==='true') return; btn.dataset.init='true'; const content=wrap.querySelector('#'+CSS.escape(btn.getAttribute('aria-controls'))); if(!content) return; const text=btn.querySelector('.oe-heading-orig__text'); const ic=btn.querySelector('.oe-heading-orig__icon svg'); const show=btn.dataset.labelShow; const hide=btn.dataset.labelHide; function set(open){btn.setAttribute('aria-expanded',open); btn.classList.toggle('is-open',open); if(text) text.textContent=open?hide:show; btn.setAttribute('aria-label','Toggle original: '+(open?hide:show)); if(open){content.removeAttribute('hidden'); const h=content.scrollHeight; content.style.height='0px'; requestAnimationFrame(()=>{content.style.transition='height .28s cubic-bezier(.4,0,.2,1)'; content.style.height=h+'px';}); setTimeout(()=>{content.style.height='';content.style.transition='';},320);} else {const h=content.scrollHeight; content.style.height=h+'px'; requestAnimationFrame(()=>{content.style.transition='height .22s cubic-bezier(.4,0,.2,1)'; content.style.height='0px';}); setTimeout(()=>{content.setAttribute('hidden',''); content.style.height=''; content.style.transition='';},240);} }
 btn.addEventListener('click',()=>set(btn.getAttribute('aria-expanded')!=='true'));
 // Inject one-time styles
 if(!document.getElementById('oe-heading-orig-style')){const st=document.createElement('style'); st.id='oe-heading-orig-style'; st.textContent=`
 .oe-heading-orig-wrap{margin:1.2rem 0 .9rem}
 /* Keep heading font style identical to default markdown heading: do not override weight/letter-spacing */
 .oe-heading-orig{display:flex;align-items:baseline;gap:.9rem;}
 .oe-heading-orig__title{font:inherit;font-weight:inherit;letter-spacing:inherit;}
 .oe-heading-orig__btn{all:unset;cursor:pointer;display:inline-flex;align-items:center;gap:.35rem;font-size:.55em;font-weight:500;color:#64748b;padding:.15rem .45rem .18rem .45rem;border-radius:5px;line-height:1.1;transition:color .2s ease,background .2s ease;} 
 .oe-heading-orig__btn:hover{color:#1e293b;background:rgba(0,0,0,.05);} 
 .oe-heading-orig__btn:focus-visible{outline:2px solid #2563eb;outline-offset:2px;} 
 .oe-heading-orig__icon{display:inline-flex;align-items:center;justify-content:center;opacity:.65;transition:opacity .25s ease,transform .34s cubic-bezier(.4,0,.2,1);} 
 .oe-heading-orig__btn:hover .oe-heading-orig__icon{opacity:.95;} 
 .oe-heading-orig__btn.is-open .oe-heading-orig__icon svg{transform:rotate(180deg);} 
 .oe-heading-orig__content{overflow:hidden;} 
 .oe-heading-orig__inner{padding:.6rem .8rem .75rem;background:rgba(0,0,0,.035);border:1px solid #e2e8f0;border-radius:8px;font-size:.98rem;line-height:1.58;} 
 .oe-heading-orig__inner :is(p,ul,ol){margin:.55rem 0;} 
 .oe-heading-orig__inner :first-child{margin-top:0;} 
 .oe-heading-orig__inner :last-child{margin-bottom:0;} 
 @media (prefers-color-scheme:dark){
  .oe-heading-orig__btn{color:#94a3b8;} 
  .oe-heading-orig__btn:hover{background:rgba(255,255,255,.06);color:#e2e8f0;} 
  .oe-heading-orig__icon{opacity:.5;} 
  .oe-heading-orig__inner{background:rgba(255,255,255,.05);border-color:#334155;color:#e2e8f0;} 
 }
 @media (max-width:640px){
  .oe-heading-orig__inner{font-size:.95rem;line-height:1.55;} 
 }
`; document.head.appendChild(st);} })();</script>